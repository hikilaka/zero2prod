name: Continous Integration

on: [ push, pull_request ]

env:
  CARGO_TERM_COLOR: always

jobs:
  check:
    name: Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/workflows/rust-cargo
        with:
          command: check

  test:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/workflows/rust-cargo
        with:
          command: test

  fmt:
    name: Format Code
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/workflows/rust-cargo
        with:
          command: fmt
          args: --all -- --check

  clippy:
    name: Lint Code
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/workflows/rust-cargo
        with:
          command: clippy
          args: -- -D warnings

  codecov:
    name: Codecov
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/workflows/rust-codecov
        with:
          codecov_token: ${{ secrets.CODECOV_TOKEN }}

  audit:
    name: Audit Codebase
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: sudo apt install libssl-dev
      - uses: ./.github/workflows/rust-cargo
        with:
          command: install
          args: cargo-audit
      - uses: ./.github/workflows/rust-cargo
        with:
          command: audit
